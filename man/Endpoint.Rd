% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/Endpoint.R
\docType{class}
\name{Endpoint}
\alias{Endpoint}
\title{Class of Endpoint}
\description{
Create a class of endpoint to specify its name, type and assign a random number
generator.
}
\examples{
set.seed(12345)
## Example 1. Generate a time-to-event endpoint.
## Two columns are returned, one for time, one for event (1/0, 0 for
## A built-in RNG function is used to handle piecewise constant exponential
## distribution
risk <- data.frame(
  end_time = c(1, 10, 26.0, 52.0),
  piecewise_risk = c(1, 1.01, 0.381, 0.150) * exp(-3.01)
)

pfs <- Endpoint$new(name = 'pfs', type='tte',
generator = PiecewiseConstantExponentialRNG,
risk = risk, endpoint_name = 'pfs')
pfs$get_generator()

## Example 2. Generate continuous and binary endpoints using R's built-in
## RNG functions, e.g. rnorm, rexp, rbinom, etc.
ep1 <- Endpoint$new(
         name = 'cd4', type = 'non-tte', generator = rnorm, readout = c(cd4=1),
         mean = 1.2)
ep2 <- Endpoint$new(
         name = 'resp_time', type = 'non-tte', generator = rexp, readout = c(resp_time=0),
         rate = 4.5)
ep3 <- Endpoint$new(
         name = 'orr', type = 'non-tte', readout = c(orr=3), generator = rbinom,
         size = 1, prob = .4)

mean(ep1$get_generator()(1e4)[, 1]) # compared to 1.2
sd(ep1$get_generator()(1e4)[, 1]) # compared to 1.0

log(2) / median(ep2$get_generator()(1e4)[, 1]) # compared to 4.5

mean(ep3$get_generator()(1e4)[, 1]) # compared to 0.4

## An example of piecewise constant exponential random number generator
## Baseline hazards are piecewise constant
## Hazard ratios are piecewise constant, resulting a delayed effect.

run <- TRUE

if (!requireNamespace("survminer", quietly = TRUE)) {
  run <- FALSE
  message("Please install 'survminer' to run this example.")
}

if (!requireNamespace("survival", quietly = TRUE)) {
  run <- FALSE
  message("Please install 'survival' to run this example.")
}

if(run){
risk1 <- risk
ep1 <- TrialSimulator::Endpoint$new(
  name = 'pfs', type='tte',
  generator = PiecewiseConstantExponentialRNG,
  risk=risk1, endpoint_name = 'pfs')

risk2 <- risk1
risk2$hazard_ratio <- c(1, 1, .6, .4)
ep2 <- TrialSimulator::Endpoint$new(
  name = 'pfs', type='tte',
  generator = PiecewiseConstantExponentialRNG,
  risk=risk2, endpoint_name = 'pfs')

n <- 1000
tte <- rbind(ep1$get_generator()(n), ep2$get_generator()(n))
arm <- rep(0:1, each = n)
dat <- data.frame(tte, arm)
sfit <- survival::survfit(
  survival::Surv(time = pfs, event = pfs_event) ~ arm, dat)

survminer::ggsurvplot(sfit,
           data = dat,
           pval = TRUE,  # Show p-value
           conf.int = TRUE,  # Show confidence intervals
           risk.table = TRUE,  # Add risk table
           palette = c("blue", "red"))

}
}
\section{Methods}{
\subsection{Public methods}{
\itemize{
\item \href{#method-Endpoint-new}{\code{Endpoint$new()}}
\item \href{#method-Endpoint-test_generator}{\code{Endpoint$test_generator()}}
\item \href{#method-Endpoint-get_generator}{\code{Endpoint$get_generator()}}
\item \href{#method-Endpoint-get_readout}{\code{Endpoint$get_readout()}}
\item \href{#method-Endpoint-get_uid}{\code{Endpoint$get_uid()}}
\item \href{#method-Endpoint-get_name}{\code{Endpoint$get_name()}}
\item \href{#method-Endpoint-get_type}{\code{Endpoint$get_type()}}
\item \href{#method-Endpoint-clone}{\code{Endpoint$clone()}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Endpoint-new"></a>}}
\if{latex}{\out{\hypertarget{method-Endpoint-new}{}}}
\subsection{Method \code{new()}}{
initialize an endpoint
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Endpoint$new(name, type = c("tte", "non-tte"), readout = NULL, generator, ...)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{name}}{character vector. Name(s) of endpoint(s)}

\item{\code{type}}{character vector. Type(s) of endpoint(s). It supports
\code{"tte"} for time-to-event endpoints, and \code{"non-tte"} for
all other types of endpoints (e.g., continous, binary, categorical,
or repeated measurement. \code{TrialSimulator} will do some verification if
an endpoint is of type \code{"tte"}. However, no special
manipulation is done for non-tte endpoints.}

\item{\code{readout}}{numeric vector with name to be the non-tte endpoint(s).
\code{readout} should be specified for every non-tte endpoint. For
example, \code{c(endpoint1 = 6, endpoint2 = 3)}.  If all
endpoints are tte, \code{readout} can be \code{NULL}.}

\item{\code{generator}}{a RNG function. Its first argument must be `n`, number of
patients. It must return a data frame of `n` rows. It support all
built-in random number generators in \code{stats}, e.g., \code{stats::rnorm},
\code{stats::rexp}, etc. that with \code{n} as the argument for number of
observations. \code{generator} could be any custom functions as long as
(1) its first argument is \code{n}; and (2) it returns a vector of
length \code{n} or a data frame of \code{n} rows. Custom random number
generator can return data of more than one endpoint. This is useful
when users need to simulate correlated endpoints. The column names of
returned data frame should match to \code{name} exactly. If an endpoint
is of type \code{"tte"}, the custom \code{generator} should also return
a column as event indicator. For example, if \code{"pfs"} is \code{"tte"},
then custom \code{generator} should return at least two columns
\code{"pfs"} and \code{"pfs_event"}. Usually \code{pfs_event} can be
all 1s if no censoring. Censoring can be specified later when defining
the \code{Trial} through argument \code{dropout}. See \code{?Trial}.
Note that if covariates, e.g., biomarker, subgroup, are needed in
generating and analyzing trial data, they can be defined as
\code{Endpoint} as well.}

\item{\code{...}}{optional arguments for \code{generator}.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Endpoint-test_generator"></a>}}
\if{latex}{\out{\hypertarget{method-Endpoint-test_generator}{}}}
\subsection{Method \code{test_generator()}}{
test random number generator of the endpoints. It returns an example
dataset.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Endpoint$test_generator(n = 1000)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{n}}{integer. Number of random numbers generated from the generator.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Endpoint-get_generator"></a>}}
\if{latex}{\out{\hypertarget{method-Endpoint-get_generator}{}}}
\subsection{Method \code{get_generator()}}{
return random number generator of an endpoint
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Endpoint$get_generator()}\if{html}{\out{</div>}}
}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Endpoint-get_readout"></a>}}
\if{latex}{\out{\hypertarget{method-Endpoint-get_readout}{}}}
\subsection{Method \code{get_readout()}}{
return readout function
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Endpoint$get_readout()}\if{html}{\out{</div>}}
}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Endpoint-get_uid"></a>}}
\if{latex}{\out{\hypertarget{method-Endpoint-get_uid}{}}}
\subsection{Method \code{get_uid()}}{
return uid
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Endpoint$get_uid()}\if{html}{\out{</div>}}
}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Endpoint-get_name"></a>}}
\if{latex}{\out{\hypertarget{method-Endpoint-get_name}{}}}
\subsection{Method \code{get_name()}}{
return endpoints' name
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Endpoint$get_name()}\if{html}{\out{</div>}}
}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Endpoint-get_type"></a>}}
\if{latex}{\out{\hypertarget{method-Endpoint-get_type}{}}}
\subsection{Method \code{get_type()}}{
return endpoints' type
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Endpoint$get_type()}\if{html}{\out{</div>}}
}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Endpoint-clone"></a>}}
\if{latex}{\out{\hypertarget{method-Endpoint-clone}{}}}
\subsection{Method \code{clone()}}{
The objects of this class are cloneable with this method.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Endpoint$clone(deep = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{deep}}{Whether to make a deep clone.}
}
\if{html}{\out{</div>}}
}
}
}
