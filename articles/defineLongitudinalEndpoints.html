<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Define Longitudinal Endpoints in Clinical Trials • TrialSimulator</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Define Longitudinal Endpoints in Clinical Trials">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">TrialSimulator</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.70.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/adaptiveDesign.html">An Example of Simulating a Trial with Adaptive Design</a></li>
    <li><a class="dropdown-item" href="../articles/conditionSystem.html">Condition System for Triggering Milestones in a Trial</a></li>
    <li><a class="dropdown-item" href="../articles/defineLongitudinalEndpoints.html">Define Longitudinal Endpoints in Clinical Trials</a></li>
    <li><a class="dropdown-item" href="../articles/defineNonTimeToEventEndpoints.html">Define Non-Time-to-Event Endpoints in Clinical Trials</a></li>
    <li><a class="dropdown-item" href="../articles/defineTimeToEventEndpoints.html">Define Time-to-Event Endpoints in Clinical Trials</a></li>
    <li><a class="dropdown-item" href="../articles/designDocument.html">Modular Clinical Trial Simulation: Overview of Core Functions and Workflow</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/zhangh12/TrialSimulator/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Define Longitudinal Endpoints in Clinical Trials</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/zhangh12/TrialSimulator/blob/main/vignettes/defineLongitudinalEndpoints.Rmd" class="external-link"><code>vignettes/defineLongitudinalEndpoints.Rmd</code></a></small>
      <div class="d-none name"><code>defineLongitudinalEndpoints.Rmd</code></div>
    </div>

    
    
<p>The · package provides a flexible framework for defining endpoints in
clinical trial simulations. Users can choose to generate endpoints using
either built-in random number generators from standard probability
distributions or custom user-defined functions. The ability to specify
custom generators is particularly useful when simulating correlated
endpoints, which often arise in longitudinal settings.</p>
<p>Longitudinal endpoints refer to outcomes measured repeatedly over
time for the same subject, such as blood pressure, biomarker levels, or
symptom severity scores. These repeated measures typically exhibit
within-subject correlation as well as correlation with baseline values.
Accurately simulating such correlation structures is essential for
realistic trial design and evaluation.</p>
<p>In this vignette, we demonstrate how to define longitudinal endpoints
using the <code><a href="../reference/endpoint.html">endpoint()</a></code> function, focusing on its
<code>generator</code> argument to specify the data-generating
mechanism, and the <code>readout</code> argument to determine when each
endpoint is observed.</p>
<div class="section level2">
<h2 id="example-simulating-longitudinal-blood-pressure-endpoints">Example: Simulating Longitudinal Blood Pressure Endpoints<a class="anchor" aria-label="anchor" href="#example-simulating-longitudinal-blood-pressure-endpoints"></a>
</h2>
<p>Suppose blood pressure is measured for each patient at baseline (week
0), and again at weeks 2 and 4 following randomization. We are
interested in changes from baseline at weeks 2 and 4. A typical dataset
at a milestone (e.g., after enrollment or follow-up) that can be
accessed by calling <code>trial$get_locked_data(milestone_name)</code>
may resemble the following:</p>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   baseline bp_cfb2 bp_cfb4</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     144.  -<span style="color: #BB0000;">24.7</span>    -<span style="color: #BB0000;">21.0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     148.  -<span style="color: #BB0000;">22.2</span>    -<span style="color: #BB0000;">42.5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     145.  -<span style="color: #BB0000;">13.4</span>    -<span style="color: #BB0000;">30.4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     148.   -<span style="color: #BB0000;">8.03</span>   -<span style="color: #BB0000;">31.2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     139.  -<span style="color: #BB0000;">28.1</span>    -<span style="color: #BB0000;">24.4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     133.  -<span style="color: #BB0000;">18.8</span>    -<span style="color: #BB0000;">18.3</span></span></span></code></pre>
<p>In this example, the variables <code>baseline</code>,
<code>bp_cfb2</code>, and <code>bp_cfb4</code> are observed at weeks 0,
2, and 4, respectively. Therefore, we will define
<code>readout = c(baseline = 0, bp_cfb2 = 2, bp_cfb4 = 4)</code> in the
endpoint definition.</p>
<p>To simulate correlated values across time points, we assume that
<code>baseline</code>, <code>bp2</code>, and <code>bp4</code> follow a
multivariate normal distribution. The user must provide the mean vector
and covariance matrix for these variables. Importantly, any custom
generator function must accept <code>n</code> (number of observations)
as its first argument, as required by TrialSimulator, otherwise it
throws an error.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://mvtnorm.R-forge.R-project.org" class="external-link">mvtnorm</a></span><span class="op">)</span></span>
<span><span class="va">bp_generator</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">bp_means</span>, <span class="va">bp_vcov</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html" class="external-link">rmvnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="va">bp_means</span>, sigma <span class="op">=</span> <span class="va">bp_vcov</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'baseline'</span>, <span class="st">'bp2'</span>, <span class="st">'bp4'</span><span class="op">)</span></span>
<span>  <span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      bp_cfb2 <span class="op">=</span> <span class="va">bp2</span> <span class="op">-</span> <span class="va">baseline</span>, </span>
<span>      bp_cfb4 <span class="op">=</span> <span class="va">bp4</span> <span class="op">-</span> <span class="va">baseline</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">baseline</span>, <span class="va">bp_cfb2</span>, <span class="va">bp_cfb4</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This function assumes a trivariate normal distribution for blood
pressure at baseline, week 2, and week 4. Users may also extend this
function to support more complex simulation logic as needed.</p>
</div>
<div class="section level2">
<h2 id="defining-endpoints-for-an-arm">Defining Endpoints for an Arm<a class="anchor" aria-label="anchor" href="#defining-endpoints-for-an-arm"></a>
</h2>
<p>We now use the <code><a href="../reference/endpoint.html">endpoint()</a></code> function to define the
longitudinal endpoints in a treatment arm. The required parameters for
the custom generator, <code>bp_means</code> and <code>bp_vcov</code>,
are passed through the ellipsis (<code>...</code>) argument.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vcov1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1.5</span>, <span class="fl">1</span>, </span>
<span>    <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">1.5</span>, </span>
<span>    <span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ep_in_trt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/endpoint.html">endpoint</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'bp_cfb2'</span>, <span class="st">'baseline'</span>, <span class="st">'bp_cfb4'</span><span class="op">)</span>, </span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'non-tte'</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>  readout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>baseline <span class="op">=</span> <span class="fl">0</span>, bp_cfb4 <span class="op">=</span> <span class="fl">4</span>, bp_cfb2 <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, </span>
<span>  generator <span class="op">=</span> <span class="va">bp_generator</span>, </span>
<span>  bp_means <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">140</span>, <span class="fl">125</span>, <span class="fl">120</span><span class="op">)</span>, </span>
<span>  bp_vcov <span class="op">=</span> <span class="va">vcov1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Note that we deliberately specify the <code>name</code> and
<code>readout</code> arguments in an order different from the data frame
returned by <code>bp_generator</code>, to illustrate that the
<code><a href="../reference/endpoint.html">endpoint()</a></code> function correctly maps variable names to their
respective time points. However, the user is responsible for ensuring
the order of <code>name</code> and <code>type</code> are aligned; the
function cannot automatically infer types from the generator output.</p>
<p>This example also demonstrates that <code><a href="../reference/endpoint.html">endpoint()</a></code> can be
used to generate covariates. For instance, the baseline value is
typically used as a covariate in statistical models, and should
therefore be simulated and retained. More generally, users can define
covariates, biomarker dynamics, or subgroup indicators using the same
mechanism to simulate complex trial designs.</p>
</div>
<div class="section level2">
<h2 id="defining-endpoints-for-another-arm">Defining Endpoints for Another Arm<a class="anchor" aria-label="anchor" href="#defining-endpoints-for-another-arm"></a>
</h2>
<p>We now define another arm with slightly different means and
correlation structure for blood pressure:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vcov2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1.5</span>, <span class="fl">1</span>, </span>
<span>    <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">1</span>, </span>
<span>    <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ep_in_trt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/endpoint.html">endpoint</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'bp_cfb2'</span>, <span class="st">'baseline'</span>, <span class="st">'bp_cfb4'</span><span class="op">)</span>, </span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'non-tte'</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>  readout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>baseline <span class="op">=</span> <span class="fl">0</span>, bp_cfb4 <span class="op">=</span> <span class="fl">4</span>, bp_cfb2 <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, </span>
<span>  generator <span class="op">=</span> <span class="va">bp_generator</span>, </span>
<span>  bp_means <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">140</span>, <span class="fl">127</span>, <span class="fl">122</span><span class="op">)</span>, </span>
<span>  bp_vcov <span class="op">=</span> <span class="va">vcov2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Note that user can even specify different generators across arms. For
example, <code>bp_generator</code> can be replaced by another function
with different mechanism and arguments.</p>
</div>
<div class="section level2">
<h2 id="creating-treatment-arms-and-adding-endpoints">Creating Treatment Arms and Adding Endpoints<a class="anchor" aria-label="anchor" href="#creating-treatment-arms-and-adding-endpoints"></a>
</h2>
<p>Finally, we create two treatment arms and attach the respective
endpoints:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/arm.html">arm</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'treatment 1'</span><span class="op">)</span></span>
<span><span class="va">trt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/arm.html">arm</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'treatment 2'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">trt1</span><span class="op">$</span><span class="fu">add_endpoints</span><span class="op">(</span><span class="va">ep_in_trt1</span><span class="op">)</span></span>
<span><span class="va">trt2</span><span class="op">$</span><span class="fu">add_endpoints</span><span class="op">(</span><span class="va">ep_in_trt2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">trt1</span></span>
<span><span class="co">#&gt; <span style="color: #BBBBBB; background-color: #0000BB;"> ⚕⚕ Arm Name:  treatment 1 </span> </span></span>
<span><span class="co">#&gt; <span style="color: #BBBBBB; background-color: #0000BB;"> ⚕⚕ Description:  treatment 1 </span> </span></span>
<span><span class="co">#&gt; <span style="color: #BBBBBB; background-color: #0000BB;"> ⚕⚕ # of Endpoints:  3 </span> </span></span>
<span><span class="co">#&gt; <span style="color: #BBBBBB; background-color: #0000BB;"> ⚕⚕ Registered Endpoints:  bp_cfb2, baseline, bp_cfb4 </span></span></span>
<span></span>
<span><span class="va">trt2</span></span>
<span><span class="co">#&gt; <span style="color: #BBBBBB; background-color: #0000BB;"> ⚕⚕ Arm Name:  treatment 2 </span> </span></span>
<span><span class="co">#&gt; <span style="color: #BBBBBB; background-color: #0000BB;"> ⚕⚕ Description:  treatment 2 </span> </span></span>
<span><span class="co">#&gt; <span style="color: #BBBBBB; background-color: #0000BB;"> ⚕⚕ # of Endpoints:  3 </span> </span></span>
<span><span class="co">#&gt; <span style="color: #BBBBBB; background-color: #0000BB;"> ⚕⚕ Registered Endpoints:  bp_cfb2, baseline, bp_cfb4 </span></span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Han Zhang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
