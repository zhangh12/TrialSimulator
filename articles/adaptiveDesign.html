<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>An Example of Simulating a Trial with Adaptive Design • TrialSimulator</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="An Example of Simulating a Trial with Adaptive Design">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">TrialSimulator</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.52.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/adaptiveDesign.html">An Example of Simulating a Trial with Adaptive Design</a></li>
    <li><a class="dropdown-item" href="../articles/comparisons.html">Comparisons with graphicalMCP and gMCP</a></li>
    <li><a class="dropdown-item" href="../articles/defineNonTimeToEventEndpoints.html">Define Non-Time-to-Event Endpoints in Clinical Trials</a></li>
    <li><a class="dropdown-item" href="../articles/defineTimeToEventEndpoints.html">Define Time-to-Event Endpoints in Clinical Trials</a></li>
    <li><a class="dropdown-item" href="../articles/designDocument.html">Modular Clinical Trial Simulation: Overview of Core Functions and Workflow</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>An Example of Simulating a Trial with Adaptive Design</h1>
            
      

      <div class="d-none name"><code>adaptiveDesign.Rmd</code></div>
    </div>

    
    
<p>In this vignette, we illustrate how to use
<code>TrialSimulator</code> to simulate a trial with seamless adaptive
design, where dose selection, futility analysis, interim analysis are
triggered by user-defined events.</p>
<p>First we define endpoints in the trial. User can define arbitrary
number of endpoints of class <code>Endpoint</code> using the
<code>new</code> function in <code>R6</code>. PFS and OS are used as
endpoints in this trial. In phase II, a binary surrogate is used for
dose selection. We consider two active arms (low or high dose) and a
placebo arm with <code>1:1:1</code> randomization. In the placebo arm,
the median of PFS and OS are 5 and 14 months, respectively. The binary
endpoint <code>surrogate</code> is of a rate 0.02. By default, the
permuted block randomization is executed.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' define endpoints in arm &lt;pbo&gt;</span></span>
<span><span class="va">pfs</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Endpoint.html">Endpoint</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>name <span class="op">=</span> <span class="st">'pfs'</span>, type<span class="op">=</span><span class="st">'tte'</span>, </span>
<span>                    generator<span class="op">=</span><span class="va">rexp</span>, rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#' test the random number generator with a method of the class Endpoint</span></span>
<span><span class="co">#' Note that user does not need to run this to set up a trial</span></span>
<span><span class="co">#' This is for illustration purpose only</span></span>
<span><span class="va">pfs_test</span> <span class="op">&lt;-</span> <span class="va">pfs</span><span class="op">$</span><span class="fu">test_generator</span><span class="op">(</span><span class="fl">10000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pfs_test</span><span class="op">)</span></span>
<span><span class="co">#&gt;         pfs pfs_event</span></span>
<span><span class="co">#&gt; 1  1.453672         1</span></span>
<span><span class="co">#&gt; 2 11.858678         1</span></span>
<span><span class="co">#&gt; 3 37.331967         1</span></span>
<span><span class="co">#&gt; 4  6.147440         1</span></span>
<span><span class="co">#&gt; 5  3.359777         1</span></span>
<span><span class="co">#&gt; 6  3.931654         1</span></span>
<span><span class="va">km</span> <span class="op">&lt;-</span> <span class="fu">survfit</span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">pfs</span>, <span class="va">pfs_event</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">pfs_test</span><span class="op">)</span></span>
<span><span class="fu">ggsurvplot</span><span class="op">(</span><span class="va">km</span>, data <span class="op">=</span> <span class="va">pfs_test</span>, legend <span class="op">=</span> <span class="st">'none'</span>, ggtheme <span class="op">=</span> <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="adaptiveDesign_files/figure-html/ljgai-1.png" width="100%"></p>
<p>Similarly, we can define OS and surrogate for placebo. Here built-in
functions <code>rexp</code> and <code>rbinom</code> are used.
User-defined functions are also supported as long as it has the first
argument <code>n</code>, number of samples to be drawn, and returns a
data frame of <code>n</code> rows. For any time-to-event endpoint (e.g.,
<code>os</code>) in the data frame, <code>TrialSimulator</code> expects
a column ending with <code>_event</code> (e.g., <code>os_event</code>)
being present as the event indicator. In general, user can define their
own generator that returns more than one endpoints. For example,
correlated endpoints would be generated together, using packages i.e.,
<code>simstudy</code>, <code>gestate</code>, <code>simdata</code>, etc.
Note that <code>surrogate</code> is not a time-to-event endpoint, so a
readout time (<code>surrogate_readout</code>) is also needed when
creating the endpoint. In this example, the readout time is 2 weeks.
Once all endpoints are defined, an arm can be defined using class
<code>Arm</code> and its method <code>new</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' define a time-to-event endpoint OS, </span></span>
<span><span class="co">#' exponential distribution with median 13.71 months</span></span>
<span><span class="va">os</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Endpoint.html">Endpoint</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>name <span class="op">=</span> <span class="st">'os'</span>, type<span class="op">=</span><span class="st">'tte'</span>, </span>
<span>                   generator <span class="op">=</span> <span class="va">rexp</span>, rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="fl">14</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">os</span><span class="op">$</span><span class="fu">test_generator</span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;            os os_event</span></span>
<span><span class="co">#&gt; 1  0.03998971        1</span></span>
<span><span class="co">#&gt; 2 16.08737886        1</span></span>
<span><span class="co">#&gt; 3  2.29270761        1</span></span>
<span><span class="co">#&gt; 4  3.22044088        1</span></span>
<span><span class="co">#&gt; 5 29.38574672        1</span></span>
<span><span class="co">#&gt; 6 24.34706238        1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">os</span><span class="op">$</span><span class="fu">test_generator</span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span><span class="op">$</span><span class="va">os</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 14.66214</span></span>
<span></span>
<span><span class="co">#' define binary endpoint VRR, with readout time = 2 weeks</span></span>
<span><span class="va">two_weeks</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">/</span> <span class="fl">52</span> <span class="op">*</span> <span class="fl">12</span></span>
<span><span class="va">surrogate</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Endpoint.html">Endpoint</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">'surrogate'</span>, type <span class="op">=</span> <span class="st">'non-tte'</span>, </span>
<span>  readout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>surrogate <span class="op">=</span> <span class="va">two_weeks</span><span class="op">)</span>, </span>
<span>  generator <span class="op">=</span> <span class="va">rbinom</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">.02</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">surrogate</span><span class="op">$</span><span class="fu">test_generator</span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   surrogate surrogate_readout</span></span>
<span><span class="co">#&gt; 1         0         0.4615385</span></span>
<span><span class="co">#&gt; 2         0         0.4615385</span></span>
<span><span class="co">#&gt; 3         0         0.4615385</span></span>
<span><span class="co">#&gt; 4         1         0.4615385</span></span>
<span><span class="co">#&gt; 5         0         0.4615385</span></span>
<span><span class="co">#&gt; 6         0         0.4615385</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">surrogate</span><span class="op">$</span><span class="fu">test_generator</span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span><span class="op">$</span><span class="va">surrogate</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.017</span></span>
<span></span>
<span><span class="co">#' define the placebo arm</span></span>
<span><span class="va">placebo</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Arm.html">Arm</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>name <span class="op">=</span> <span class="st">'pbo'</span>, description <span class="op">=</span> <span class="st">'placebo'</span><span class="op">)</span></span>
<span><span class="co">#' add endpoints into the arm</span></span>
<span><span class="va">placebo</span><span class="op">$</span><span class="fu">add_endpoints</span><span class="op">(</span><span class="va">pfs</span>, <span class="va">os</span>, <span class="va">surrogate</span><span class="op">)</span></span></code></pre></div>
<p>Likewise, we can define the three endpoints in the two active
arms.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' define endpoints in the low dose arm</span></span>
<span><span class="co">#' hazard ratios </span></span>
<span><span class="va">hr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>pfs_low <span class="op">=</span> <span class="fl">0.7</span>, os_low <span class="op">=</span> <span class="fl">0.8</span>, pfs_high <span class="op">=</span> <span class="fl">0.65</span>, os_high <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pfs</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Endpoint.html">Endpoint</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>name <span class="op">=</span> <span class="st">'pfs'</span>, type<span class="op">=</span><span class="st">'tte'</span>, </span>
<span>                    generator <span class="op">=</span> <span class="va">rexp</span>, rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="fl">5</span> <span class="op">*</span> <span class="va">hr</span><span class="op">[</span><span class="st">'pfs_low'</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">surrogate</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Endpoint.html">Endpoint</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">'surrogate'</span>, type <span class="op">=</span> <span class="st">'non-tte'</span>, readout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>surrogate <span class="op">=</span> <span class="va">two_weeks</span><span class="op">)</span>, </span>
<span>  generator <span class="op">=</span> <span class="va">rbinom</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span> <span class="co"># lower probability</span></span>
<span></span>
<span><span class="va">os</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Endpoint.html">Endpoint</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>name <span class="op">=</span> <span class="st">'os'</span>, type<span class="op">=</span><span class="st">'tte'</span>, </span>
<span>                   generator<span class="op">=</span><span class="va">rexp</span>, rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="fl">14</span> <span class="op">*</span> <span class="va">hr</span><span class="op">[</span><span class="st">'os_low'</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">low</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Arm.html">Arm</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>name <span class="op">=</span> <span class="st">'low dose'</span>, description <span class="op">=</span> <span class="st">'treated with low dose'</span><span class="op">)</span></span>
<span><span class="va">low</span><span class="op">$</span><span class="fu">add_endpoints</span><span class="op">(</span><span class="va">pfs</span>, <span class="va">os</span>, <span class="va">surrogate</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' define endpoints in the high dose arm</span></span>
<span><span class="va">pfs</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Endpoint.html">Endpoint</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>name <span class="op">=</span> <span class="st">'pfs'</span>, type<span class="op">=</span><span class="st">'tte'</span>, </span>
<span>                    generator <span class="op">=</span> <span class="va">rexp</span>, rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="fl">5</span> <span class="op">*</span> <span class="va">hr</span><span class="op">[</span><span class="st">'pfs_high'</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">surrogate</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Endpoint.html">Endpoint</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">'surrogate'</span>, type <span class="op">=</span> <span class="st">'non-tte'</span>, readout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>surrogate <span class="op">=</span> <span class="va">two_weeks</span><span class="op">)</span>, </span>
<span>  generator <span class="op">=</span> <span class="va">rbinom</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">.12</span><span class="op">)</span> <span class="co"># higher probability</span></span>
<span></span>
<span><span class="va">os</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Endpoint.html">Endpoint</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>name <span class="op">=</span> <span class="st">'os'</span>, type<span class="op">=</span><span class="st">'tte'</span>, </span>
<span>                   generator<span class="op">=</span><span class="va">rexp</span>, rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="fl">14</span> <span class="op">*</span> <span class="va">hr</span><span class="op">[</span><span class="st">'os_high'</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">high</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Arm.html">Arm</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>name <span class="op">=</span> <span class="st">'high dose'</span>, description <span class="op">=</span> <span class="st">'treated with high dose'</span><span class="op">)</span></span>
<span><span class="va">high</span><span class="op">$</span><span class="fu">add_endpoints</span><span class="op">(</span><span class="va">pfs</span>, <span class="va">os</span>, <span class="va">surrogate</span><span class="op">)</span></span></code></pre></div>
<p>With three arms, we can define a trial of class <code>Trial</code>,
where up to 1000 patients are enrolled. Recruitment curve are specified
through <code>enroller</code> with a built-in function
<code>StaggeredRecruiter</code> of piecewise constant rate: 20 patients
per month until 15 months, and then 25 patients per month until the end
of the trial. built-in random number functions like <code>rexp</code>
and user-defined function are also accepted. Sample ratio can be
specified through <code>sample_ratio</code>, which can be updated during
a trial using method <code>update_sample_ratio</code>. We set a dropout
rate 25% per 12 months. By default, no dropout if users do not specify
one.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">accrual_rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>end_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="cn">Inf</span><span class="op">)</span>, </span>
<span>                           piecewise_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">trial</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Trial.html">Trial</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">'Trial-3415'</span>, n_patients <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>, duration <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  enroller <span class="op">=</span> <span class="va">StaggeredRecruiter</span>, accrual_rate <span class="op">=</span> <span class="va">accrual_rate</span>, </span>
<span>  dropout <span class="op">=</span> <span class="va">rexp</span>, rate <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">0.25</span><span class="op">)</span><span class="op">/</span><span class="fl">12</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Seed is not specified. TrialSimulator sets it to 634300041</span></span>
<span></span>
<span><span class="va">trial</span><span class="op">$</span><span class="fu">add_arms</span><span class="op">(</span>sample_ratio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, <span class="va">low</span>, <span class="va">high</span>, <span class="va">placebo</span><span class="op">)</span></span>
<span><span class="co">#&gt; Arm(s) &lt;low dose, high dose, pbo&gt; are added to the trial.</span></span>
<span><span class="co">#&gt; Randomization is done for 1000 potential patients.</span></span>
<span><span class="co">#&gt; Data of 1000 potential patients are generated for the trial with 3 arm(s) &lt;low dose, high dose, pbo&gt;.</span></span></code></pre></div>
<p>The class <code>Trial</code> maintains a clock
(<code>trial$get_current_time()</code>). Data of patients who are
enrolled before the time point are considered locked and cannot be
changed. Data of patients who is not yet recruited will be regenerated
immediately whenever the setting of trial are updated. Note that
randomization may be re-executed. Trial’s setting is considered changed
if an arm is added (method <code>add_arms</code>), removed (method
<code>remove_arms</code>) or the sample ratio of one or multiple arm(s)
is updated (method <code>update_sample_ratio</code>). These methods are
usually invoked in user-defined action function when pre-specified
events are triggered, which will be discussed later.</p>
<p>The <code>Trial</code> only manages its arms and endpoints. In
<code>TrialSimulator</code>, a <code>Listener</code> is used to launch
and monitor a trial according to a set of <code>Event</code> that
register to it. An event consists two main parts, one is the condition
to trigger it, one is the action function defining the action to be
taken once the condition is met. Usually, a condition is met if a
pre-specified number of events (or samples) are observed, or a specific
calendar time is reached. In this example, four events are defined for
dose selection, futility, interim and final analysis.</p>
<p>Dose selection and a non-binding futility analysis are planned to be
done at month 12. A built-in function <code>calendarTime</code> is used
as the condition function. Once data is locked, and trial’s clock is
updated. A user-defined action function,
<code>dose_selection_action</code> will be executed by the listener. It
is recommended that the user should load the locked data at current time
in the action function. Analysis is then performed on it to support
further actions. In this example, an active arm can be dropped, and
sample ratio of the remaining arms are updated accordingly. All not yet
enrolled patients’ data is then regenerated afterward.
<code>Trial</code> has a public member function <code>save</code> for
user to save results for analysis or summary later. Note that
<code>save</code> will be invoked automatically when an event is
triggered to save event time.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' action function is defined by user. </span></span>
<span><span class="co">#' it always take at least two arguments, </span></span>
<span><span class="co">#' (1) trial: an object of class Trial</span></span>
<span><span class="co">#' (2) event_name: character of event's name</span></span>
<span><span class="co">#' It is recommended that user should always requests for the locked data</span></span>
<span><span class="co">#' at current time when the event is triggered, from which the user can </span></span>
<span><span class="co">#' carry out various analysis fitting their purpose</span></span>
<span><span class="va">dose_selection_action</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">trial</span>, <span class="va">event_name</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="va">locked_data</span> <span class="op">&lt;-</span> <span class="va">trial</span><span class="op">$</span><span class="fu">get_locked_data</span><span class="op">(</span><span class="va">event_name</span><span class="op">)</span></span>
<span>  <span class="co">## do something with locked_data, e.g. estimate, Dunnett test, etc.,</span></span>
<span>  <span class="co">## to support further actions</span></span>
<span>  <span class="co">## ...</span></span>
<span></span>
<span>  <span class="co">## this is just for illustration</span></span>
<span>  <span class="co">## pick an arm to drop</span></span>
<span>  <span class="va">removed_arm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'high dose'</span>, <span class="st">'low dose'</span>, <span class="st">'none'</span><span class="op">)</span>, </span>
<span>                        size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">.6</span>, <span class="fl">.2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">## action 1: remove an arm &lt;affected_arm&gt;</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">removed_arm</span> <span class="op">==</span> <span class="st">'none'</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">trial</span><span class="op">$</span><span class="fu">remove_arms</span><span class="op">(</span><span class="va">removed_arm</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">## action 2: update sample ratio for the remaining arms</span></span>
<span>  <span class="va">trial</span><span class="op">$</span><span class="fu">update_sample_ratio</span><span class="op">(</span><span class="st">'pbo'</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">removed_arm</span> <span class="op">==</span> <span class="st">'high dose'</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co">## if low dose arm is kept, increase its ratio</span></span>
<span>    <span class="va">trial</span><span class="op">$</span><span class="fu">update_sample_ratio</span><span class="op">(</span><span class="st">'low dose'</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="kw">else</span><span class="op">{</span></span>
<span>    <span class="co">## if high dose arm is kept, reduce its ratio for safety</span></span>
<span>    <span class="va">trial</span><span class="op">$</span><span class="fu">update_sample_ratio</span><span class="op">(</span><span class="st">'high dose'</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># action 3: non-binding futility analysis</span></span>
<span>  <span class="va">z_pfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## save results, which can be accessed later using trial$get_output()</span></span>
<span>  <span class="va">trial</span><span class="op">$</span><span class="fu">save</span><span class="op">(</span>value <span class="op">=</span> <span class="va">removed_arm</span>, name <span class="op">=</span> <span class="st">'removed_arm'</span><span class="op">)</span></span>
<span>  <span class="va">trial</span><span class="op">$</span><span class="fu">save</span><span class="op">(</span>value <span class="op">=</span> <span class="va">z_pfs</span>, name <span class="op">=</span> <span class="st">'z_futility'</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## Not necessary because event time is saved automatically when the event is triggered</span></span>
<span>  <span class="co"># trial$save(value = trial$get_event_time(event_name), name = 'futility_time')</span></span>
<span></span>
<span>  <span class="co">## return for displaying purpose (print on screen later)</span></span>
<span>  <span class="co">## user can return NULL</span></span>
<span>  <span class="va">action</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>    type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'remove'</span>, <span class="st">'update sample ratio'</span>, <span class="st">'non-binding futility'</span><span class="op">)</span>,</span>
<span>    value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">removed_arm</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">removed_arm</span> <span class="op">==</span> <span class="st">'high dose'</span>, <span class="st">'low dose -&gt; 2'</span>, <span class="st">'high dose -&gt; 1'</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'z (pfs) = '</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">z_pfs</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">action</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## dose selection is carried out at month 12</span></span>
<span><span class="va">dose_selection_event</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Event.html">Event</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>name <span class="op">=</span> <span class="st">'dose selection'</span>, type <span class="op">=</span> <span class="st">'dose selection'</span>,</span>
<span>                                  trigger_condition <span class="op">=</span> <span class="fu"><a href="../reference/calendarTime.html">calendarTime</a></span><span class="op">(</span><span class="fl">12</span> <span class="op">+</span> <span class="va">two_weeks</span><span class="op">)</span>,</span>
<span>                                  action <span class="op">=</span> <span class="va">dose_selection_action</span><span class="op">)</span></span></code></pre></div>
<p>Likewise, we can define events for interim and final analyses of PFS
and OS. The interim analysis for PFS will be carried out when 150 events
are observed in remaining arms. The triggering condition is set by the
built-in function <code>eventNumber</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' event to trigger interim analysis for PFS</span></span>
<span><span class="va">pfs_interim_action</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">trial</span>, <span class="va">event_name</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="va">locked_data</span> <span class="op">&lt;-</span> <span class="va">trial</span><span class="op">$</span><span class="fu">get_locked_data</span><span class="op">(</span><span class="va">event_name</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">## this p-value is just for illustration</span></span>
<span>  <span class="co">## it can be calculated from locked_data</span></span>
<span>  <span class="va">pfs_interim_pval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1e-3</span>, <span class="fl">.05</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">trial</span><span class="op">$</span><span class="fu">save</span><span class="op">(</span>value <span class="op">=</span> <span class="va">pfs_interim_pval</span>, name <span class="op">=</span> <span class="st">'pfs_interim_pval'</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">## action 1: if pfs is significant, increase its sample ratio</span></span>
<span>  <span class="co">##           and reduce sample ratio of pbo.</span></span>
<span>  <span class="co">##           otherwise no action.</span></span>
<span>  <span class="va">action</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'No action. P-value: &lt;pfs interim = '</span>,</span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">signif</a></span><span class="op">(</span><span class="va">pfs_interim_pval</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">'&gt;. '</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">pfs_interim_pval</span> <span class="op">&lt;</span> <span class="fl">.05</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">active_arm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">trial</span><span class="op">$</span><span class="fu">get_arms_name</span><span class="op">(</span><span class="op">)</span>, <span class="st">'pbo'</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">trial</span><span class="op">$</span><span class="fu">update_sample_ratio</span><span class="op">(</span><span class="va">active_arm</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="va">trial</span><span class="op">$</span><span class="fu">update_sample_ratio</span><span class="op">(</span><span class="st">'pbo'</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co">## for displaying purpose, not essential</span></span>
<span>    <span class="va">action</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>      type <span class="op">=</span> <span class="st">'update sample ratio'</span>,</span>
<span>      value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">active_arm</span>, <span class="st">' -&gt; 2'</span><span class="op">)</span>, <span class="st">'pbo -&gt; 1'</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co">## return for displaying purpose</span></span>
<span>  <span class="va">action</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">pfs_interim_event</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Event.html">Event</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>name <span class="op">=</span> <span class="st">'pfs interim'</span>, type <span class="op">=</span> <span class="st">'interim analysis'</span>, </span>
<span>                               trigger_condition <span class="op">=</span> <span class="fu"><a href="../reference/eventNumber.html">eventNumber</a></span><span class="op">(</span><span class="st">'pfs'</span>, <span class="fl">150</span><span class="op">)</span>, </span>
<span>                               action <span class="op">=</span> <span class="va">pfs_interim_action</span><span class="op">)</span></span></code></pre></div>
<p>The final analysis for PFS will be performed with an interim of OS
when 400 events are observed for PFS, or 250 events for OS, whichever
comes first. Note that combined triggering condition can be specified
using logical operation <code>&amp;</code> and/or <code>|</code>. In
this example, we use
<code>eventNumber('pfs', 400) | eventNumber('os', 250)</code>. Nested
condition combination are also supported. For example, we can require
that this event is not triggered until the trial has been run for at
least 30 months by
<code>calendarTime(30) &amp; (eventNumber('pfs', 400) | eventNumber('os', 250))</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#'  event to trigger final analysis for PFS and interim analysis for OS</span></span>
<span><span class="co">#'  In this example, the triggering condition is defined by number of events </span></span>
<span><span class="co">#'  of PFS and OS together. See meet = 'any' below.</span></span>
<span><span class="va">pfs_final_action</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">trial</span>, <span class="va">event_name</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="va">locked_data</span> <span class="op">&lt;-</span> <span class="va">trial</span><span class="op">$</span><span class="fu">get_locked_data</span><span class="op">(</span><span class="va">event_name</span><span class="op">)</span></span>
<span>  <span class="co">## do something with locked_data, e.g. estimate, test, etc.,</span></span>
<span>  <span class="co">## to support further actions</span></span>
<span>  <span class="co">## ...</span></span>
<span></span>
<span>  <span class="co">## this is just for illustration</span></span>
<span>  <span class="va">pfs_final_pval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span>  <span class="va">os_interim_pval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0.3</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">trial</span><span class="op">$</span><span class="fu">save</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>pfs_final_pval<span class="op">=</span><span class="va">pfs_final_pval</span>, os_interim_pval<span class="op">=</span><span class="va">os_interim_pval</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co">## only compute p-values for pfs and os, no further action</span></span>
<span>  <span class="va">action</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'No action. P-values: &lt;pfs final = '</span>,</span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">signif</a></span><span class="op">(</span><span class="va">pfs_final_pval</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                   <span class="st">'&gt;, &lt;os interim = '</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">signif</a></span><span class="op">(</span><span class="va">os_interim_pval</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">'&gt;.'</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">## return for displaying purpose</span></span>
<span>  <span class="va">action</span></span>
<span></span>
<span><span class="op">}</span></span>
<span><span class="co">## meet = 'any' means that final analysis for PFS is triggered</span></span>
<span><span class="co">## when pfs event reaches 400 or os event reaches 250.</span></span>
<span><span class="co">## if meet = 'all', then final analysis for PFS is carried out only if</span></span>
<span><span class="co">## both conditions are met.</span></span>
<span><span class="va">pfs_final_event</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Event.html">Event</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>name <span class="op">=</span> <span class="st">'pfs final'</span>, type <span class="op">=</span> <span class="st">'pfs final/os interim'</span>, </span>
<span>                             trigger_condition <span class="op">=</span> </span>
<span>                               <span class="fu"><a href="../reference/eventNumber.html">eventNumber</a></span><span class="op">(</span><span class="st">'pfs'</span>, <span class="fl">400</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="../reference/eventNumber.html">eventNumber</a></span><span class="op">(</span><span class="st">'os'</span>, <span class="fl">250</span><span class="op">)</span>, </span>
<span>                             action <span class="op">=</span> <span class="va">pfs_final_action</span><span class="op">)</span></span></code></pre></div>
<p>Finally, one more analysis will be done for OS only at month 64.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#'  event to trigger final analysis OS</span></span>
<span><span class="co">#'  triggering condition: month 50</span></span>
<span><span class="va">os_final_action</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">trial</span>, <span class="va">event_name</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="va">locked_data</span> <span class="op">&lt;-</span> <span class="va">trial</span><span class="op">$</span><span class="fu">get_locked_data</span><span class="op">(</span><span class="va">event_name</span><span class="op">)</span></span>
<span>  <span class="co">## do something with locked_data, e.g. estimate, test, etc.,</span></span>
<span>  <span class="co">## to support further actions</span></span>
<span>  <span class="co">## ...</span></span>
<span></span>
<span>  <span class="co">## this is just for illustration</span></span>
<span>  <span class="va">os_final_pval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1e-3</span>, <span class="fl">.1</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">trial</span><span class="op">$</span><span class="fu">save</span><span class="op">(</span><span class="va">os_final_pval</span>, <span class="st">'os_final_pval'</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">## action 1: end the trial, no futher action</span></span>
<span>  <span class="va">action</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'No action. P-value: &lt;os final = '</span>,</span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">signif</a></span><span class="op">(</span><span class="va">os_final_pval</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">'&gt;. '</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">## return for displaying purpose</span></span>
<span>  <span class="va">action</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">os_final_event</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Event.html">Event</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>name <span class="op">=</span> <span class="st">'os final'</span>, type <span class="op">=</span> <span class="st">'os final analysis'</span>,</span>
<span>                            trigger_condition <span class="op">=</span> <span class="fu"><a href="../reference/calendarTime.html">calendarTime</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span>,</span>
<span>                            action <span class="op">=</span> <span class="va">os_final_action</span><span class="op">)</span></span></code></pre></div>
<p>Now we can register the four events with the listener, and launch the
trial.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">listener</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Listener.html">Listener</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#' register events with listener</span></span>
<span><span class="va">listener</span><span class="op">$</span><span class="fu">add_events</span><span class="op">(</span></span>
<span>  <span class="va">dose_selection_event</span>,</span>
<span>  <span class="va">pfs_interim_event</span>,</span>
<span>  <span class="va">pfs_final_event</span>,</span>
<span>  <span class="va">os_final_event</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; An event &lt;dose selection&gt; is registered.</span></span>
<span><span class="co">#&gt; An event &lt;pfs interim&gt; is registered.</span></span>
<span><span class="co">#&gt; An event &lt;pfs final&gt; is registered.</span></span>
<span><span class="co">#&gt; An event &lt;os final&gt; is registered.</span></span>
<span></span>
<span><span class="va">controller</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Controller.html">Controller</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">trial</span>, <span class="va">listener</span><span class="op">)</span></span>
<span><span class="va">controller</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span>silent <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Conditioin of event &lt;dose selection&gt; is being checked.</span></span>
<span><span class="co">#&gt; Data is locked at time = 12.4615384615385 for event &lt;dose selection&gt;.</span></span>
<span><span class="co">#&gt; Locked data can be accessed in Trial$get_locked_data('dose selection'). </span></span>
<span><span class="co">#&gt; Number of events at lock time:</span></span>
<span><span class="co">#&gt;   patient pfs os surrogate                       arms</span></span>
<span><span class="co">#&gt; 1     249  97 37       206 &lt;low dose, high dose, pbo&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Arm &lt;low dose&gt; is removed.</span></span>
<span><span class="co">#&gt; Sample ratio is updated to be &lt;high dose: 1, pbo: 1&gt;.</span></span>
<span><span class="co">#&gt; Trial data is rolling back to time = 12.4615384615385. </span></span>
<span><span class="co">#&gt; Randomization will be carried out again for unenrolled patients.</span></span>
<span><span class="co">#&gt; Randomization is done for 751 potential patients.</span></span>
<span><span class="co">#&gt; Data of 751 potential patients are generated for the trial with 2 arm(s) &lt;high dose, pbo&gt;.</span></span>
<span><span class="co">#&gt; Sample ratio has been udpated to be &lt;high dose: 1, pbo: 1&gt;.</span></span>
<span><span class="co">#&gt; Trial data is rolling back to time = 12.4615384615385. </span></span>
<span><span class="co">#&gt; Randomization will be carried out again for unenrolled patients.</span></span>
<span><span class="co">#&gt; Randomization is done for 751 potential patients.</span></span>
<span><span class="co">#&gt; Data of 751 potential patients are generated for the trial with 2 arm(s) &lt;high dose, pbo&gt;.</span></span>
<span><span class="co">#&gt; Sample ratio has been udpated to be &lt;high dose: 1, pbo: 1&gt;.</span></span>
<span><span class="co">#&gt; Trial data is rolling back to time = 12.4615384615385. </span></span>
<span><span class="co">#&gt; Randomization will be carried out again for unenrolled patients.</span></span>
<span><span class="co">#&gt; Randomization is done for 751 potential patients.</span></span>
<span><span class="co">#&gt; Data of 751 potential patients are generated for the trial with 2 arm(s) &lt;high dose, pbo&gt;.</span></span>
<span><span class="co">#&gt; Action for &lt;dose selection&gt; is executed:</span></span>
<span><span class="co">#&gt;   order                 type          value</span></span>
<span><span class="co">#&gt; 1     1               remove       low dose</span></span>
<span><span class="co">#&gt; 2     2  update sample ratio high dose -&gt; 1</span></span>
<span><span class="co">#&gt; 3     3 non-binding futility z (pfs) = 0.85</span></span>
<span><span class="co">#&gt; Conditioin of event &lt;pfs interim&gt; is being checked.</span></span>
<span><span class="co">#&gt; Data is locked at time = 21.7365529104553 for event &lt;pfs interim&gt;.</span></span>
<span><span class="co">#&gt; Locked data can be accessed in Trial$get_locked_data('pfs interim'). </span></span>
<span><span class="co">#&gt; Number of events at lock time:</span></span>
<span><span class="co">#&gt;   patient pfs os surrogate             arms</span></span>
<span><span class="co">#&gt; 1     385 150 72       283 &lt;high dose, pbo&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Sample ratio has been udpated to be &lt;high dose: 2, pbo: 1&gt;.</span></span>
<span><span class="co">#&gt; Trial data is rolling back to time = 21.7365529104553. </span></span>
<span><span class="co">#&gt; Randomization will be carried out again for unenrolled patients.</span></span>
<span><span class="co">#&gt; Randomization is done for 532 potential patients.</span></span>
<span><span class="co">#&gt; Data of 532 potential patients are generated for the trial with 2 arm(s) &lt;high dose, pbo&gt;.</span></span>
<span><span class="co">#&gt; Sample ratio has been udpated to be &lt;high dose: 2, pbo: 1&gt;.</span></span>
<span><span class="co">#&gt; Trial data is rolling back to time = 21.7365529104553. </span></span>
<span><span class="co">#&gt; Randomization will be carried out again for unenrolled patients.</span></span>
<span><span class="co">#&gt; Randomization is done for 532 potential patients.</span></span>
<span><span class="co">#&gt; Data of 532 potential patients are generated for the trial with 2 arm(s) &lt;high dose, pbo&gt;.</span></span>
<span><span class="co">#&gt; Action for &lt;pfs interim&gt; is executed:</span></span>
<span><span class="co">#&gt;   order                type          value</span></span>
<span><span class="co">#&gt; 1     1 update sample ratio high dose -&gt; 2</span></span>
<span><span class="co">#&gt; 2     2 update sample ratio       pbo -&gt; 1</span></span>
<span><span class="co">#&gt; Conditioin of event &lt;pfs final&gt; is being checked.</span></span>
<span><span class="co">#&gt; Data is locked at time = 45.0927414108545 for event &lt;pfs final&gt;.</span></span>
<span><span class="co">#&gt; Locked data can be accessed in Trial$get_locked_data('pfs final'). </span></span>
<span><span class="co">#&gt; Number of events at lock time:</span></span>
<span><span class="co">#&gt;   patient pfs  os surrogate             arms</span></span>
<span><span class="co">#&gt; 1     917 397 250       536 &lt;high dose, pbo&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Action for &lt;pfs final&gt; is executed:</span></span>
<span><span class="co">#&gt; [1] "No action. P-values: &lt;pfs final = 0.042&gt;, &lt;os interim = 0.074&gt;."</span></span>
<span><span class="co">#&gt; Conditioin of event &lt;os final&gt; is being checked.</span></span>
<span><span class="co">#&gt; Data is locked at time = 50 for event &lt;os final&gt;.</span></span>
<span><span class="co">#&gt; Locked data can be accessed in Trial$get_locked_data('os final'). </span></span>
<span><span class="co">#&gt; Number of events at lock time:</span></span>
<span><span class="co">#&gt;   patient pfs  os surrogate             arms</span></span>
<span><span class="co">#&gt; 1     917 416 271       536 &lt;high dose, pbo&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Action for &lt;os final&gt; is executed:</span></span>
<span><span class="co">#&gt; [1] "No action. P-value: &lt;os final = 0.065&gt;. "</span></span></code></pre></div>
<p><img src="adaptiveDesign_files/figure-html/aloganl-1.png" width="100%"></p>
<p>In the action functions, user can save results to the
<code>Trial</code> object using its public member function
<code>save</code> or any place they chose so that they can summarize the
trial later. The package can also summarize commonly used metrics by
default. For common design, the package can carry out standard analysis,
e.g., group sequential design with combination test or graphical test as
well, which would be implemented and tested later.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trial</span><span class="op">$</span><span class="fu">get_output</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;        trial      seed event_time_&lt;dose selection&gt;</span></span>
<span><span class="co">#&gt; 1 Trial-3415 634300041                    12.46154</span></span>
<span><span class="co">#&gt;   n_events_&lt;dose selection&gt;_&lt;patient_id&gt; n_events_&lt;dose selection&gt;_&lt;pfs&gt;</span></span>
<span><span class="co">#&gt; 1                                    249                              97</span></span>
<span><span class="co">#&gt;   n_events_&lt;dose selection&gt;_&lt;os&gt; n_events_&lt;dose selection&gt;_&lt;surrogate&gt;</span></span>
<span><span class="co">#&gt; 1                             37                                   206</span></span>
<span><span class="co">#&gt;   n_events_&lt;dose selection&gt;_&lt;arms&gt; removed_arm z_futility</span></span>
<span><span class="co">#&gt; 1       &lt;low dose, high dose, pbo&gt;    low dose  0.8513003</span></span>
<span><span class="co">#&gt;   event_time_&lt;pfs interim&gt; n_events_&lt;pfs interim&gt;_&lt;patient_id&gt;</span></span>
<span><span class="co">#&gt; 1                 21.73655                                 385</span></span>
<span><span class="co">#&gt;   n_events_&lt;pfs interim&gt;_&lt;pfs&gt; n_events_&lt;pfs interim&gt;_&lt;os&gt;</span></span>
<span><span class="co">#&gt; 1                          150                          72</span></span>
<span><span class="co">#&gt;   n_events_&lt;pfs interim&gt;_&lt;surrogate&gt; n_events_&lt;pfs interim&gt;_&lt;arms&gt;</span></span>
<span><span class="co">#&gt; 1                                283              &lt;high dose, pbo&gt;</span></span>
<span><span class="co">#&gt;   pfs_interim_pval event_time_&lt;pfs final&gt; n_events_&lt;pfs final&gt;_&lt;patient_id&gt;</span></span>
<span><span class="co">#&gt; 1       0.02158786               45.09274                               917</span></span>
<span><span class="co">#&gt;   n_events_&lt;pfs final&gt;_&lt;pfs&gt; n_events_&lt;pfs final&gt;_&lt;os&gt;</span></span>
<span><span class="co">#&gt; 1                        397                       250</span></span>
<span><span class="co">#&gt;   n_events_&lt;pfs final&gt;_&lt;surrogate&gt; n_events_&lt;pfs final&gt;_&lt;arms&gt; pfs_final_pval</span></span>
<span><span class="co">#&gt; 1                              536            &lt;high dose, pbo&gt;     0.04169019</span></span>
<span><span class="co">#&gt;   os_interim_pval event_time_&lt;os final&gt; n_events_&lt;os final&gt;_&lt;patient_id&gt;</span></span>
<span><span class="co">#&gt; 1      0.07357926                    50                              917</span></span>
<span><span class="co">#&gt;   n_events_&lt;os final&gt;_&lt;pfs&gt; n_events_&lt;os final&gt;_&lt;os&gt;</span></span>
<span><span class="co">#&gt; 1                       416                      271</span></span>
<span><span class="co">#&gt;   n_events_&lt;os final&gt;_&lt;surrogate&gt; n_events_&lt;os final&gt;_&lt;arms&gt; os_final_pval</span></span>
<span><span class="co">#&gt; 1                             536           &lt;high dose, pbo&gt;     0.0648494</span></span>
<span><span class="co">#&gt;   error_message</span></span>
<span><span class="co">#&gt; 1</span></span></code></pre></div>
<p>In summary, <code>TrialSimulator</code> abstracts the data generation
and management to allow user focus on implementing the statistical
analysis. It simulates a trial on patient level, and provide flexibility
in adaptive design.</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Han Zhang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
