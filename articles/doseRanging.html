<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Dose-Ranging Study • TrialSimulator</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Dose-Ranging Study">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">TrialSimulator</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.8.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/actionFunctions.html">Specify Actions to Execute at Trial Milestones</a></li>
    <li><a class="dropdown-item" href="../articles/adaptiveDesign.html">An Example of Simulating a Trial with Adaptive Design</a></li>
    <li><a class="dropdown-item" href="../articles/conditionSystem.html">Condition System for Triggering Milestones in a Trial</a></li>
    <li><a class="dropdown-item" href="../articles/defineArms.html">Define and Summarize Arms in Clinical Trials</a></li>
    <li><a class="dropdown-item" href="../articles/defineLongitudinalEndpoints.html">Define Longitudinal Endpoints</a></li>
    <li><a class="dropdown-item" href="../articles/defineNonTimeToEventEndpoints.html">Define Non-Time-to-Event Endpoints</a></li>
    <li><a class="dropdown-item" href="../articles/defineTimeToEventEndpoints.html">Define Time-to-Event Endpoints</a></li>
    <li><a class="dropdown-item" href="../articles/doseRanging.html">Dose-Ranging Study</a></li>
    <li><a class="dropdown-item" href="../articles/fixedDesign.html">An Example of Fixed Design with Two Correlated Endpoints</a></li>
    <li><a class="dropdown-item" href="../articles/responseAdaptive.html">Designs with Response-Adaptive Randomization</a></li>
    <li><a class="dropdown-item" href="../articles/simulatePfsAndOs.html">Simulate Correlated Progression-Free Survival and Overall Survival as Endpoints</a></li>
    <li><a class="dropdown-item" href="../articles/wrappers.html">Wrapper Functions of Common Statistical Methods in TrialSimulator</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/zhangh12/TrialSimulator/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="doseRanging_files/kePrint-0.0.1/kePrint.js"></script><link href="doseRanging_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Dose-Ranging Study</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/zhangh12/TrialSimulator/blob/main/vignettes/doseRanging.Rmd" class="external-link"><code>vignettes/doseRanging.Rmd</code></a></small>
      <div class="d-none name"><code>doseRanging.Rmd</code></div>
    </div>

    
    
<p>In this vignette, we implement simulation for a dose-ranging trial
under adaptive design. We start from a placebo arm and a treatment arm
with highest possible dose. At an interim, if we observe promising
results, we add arms with doses in between to inform decision at final
analysis.</p>
<p>For the sake of simplicity, we assume a binary endpoint of interest.
The response rates at doses 0 (placebo), 0.5, 1.5, 2.5, 4 (highest dose)
are given by a <code>sigEmax</code> model below, where the response rate
is assume to be 10% in placebo, and 25% in arm of the highest dose (dose
= 4). For further background information, refer to <a href="https://cran.r-project.org/package=DoseFinding/vignettes/binary_data.html" class="external-link">vignette</a>
of the <code>DoseFinding</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mods</span> <span class="op">&lt;-</span> <span class="fu">DoseFinding</span><span class="fu">::</span><span class="fu"><a href="https://openpharma.github.io/DoseFinding/reference/Mods.html" class="external-link">Mods</a></span><span class="op">(</span>sigEmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                          placEff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">.1</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                          maxEff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.25</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">.25</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">.1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                          doses <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">2.5</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">DoseFinding</span><span class="fu">::</span><span class="fu"><a href="https://openpharma.github.io/DoseFinding/reference/Mods.html" class="external-link">plotMods</a></span><span class="op">(</span><span class="va">mods</span>, trafo <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="doseRanging_files/figure-html/flaf-1.png" class="r-plt" alt="" width="100%"></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## response rates on curve</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">DoseFinding</span><span class="fu">::</span><span class="fu"><a href="https://openpharma.github.io/DoseFinding/reference/Mods.html" class="external-link">getResp</a></span><span class="op">(</span><span class="va">mods</span>, doses <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">2.5</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      sigEmax1</span></span>
<span><span class="co">#&gt; 0   0.1000000</span></span>
<span><span class="co">#&gt; 0.5 0.1117242</span></span>
<span><span class="co">#&gt; 1.5 0.2080893</span></span>
<span><span class="co">#&gt; 2.5 0.2407520</span></span>
<span><span class="co">#&gt; 4   0.2500000</span></span>
<span><span class="co">#&gt; attr(,"parList")</span></span>
<span><span class="co">#&gt; attr(,"parList")$sigEmax1</span></span>
<span><span class="co">#&gt;        e0      eMax      ed50         h </span></span>
<span><span class="co">#&gt; -2.197225  1.115778  1.000000  3.000000</span></span></code></pre></div>
<p>Any function invoked via the <code>trial$*</code> interface is
documented under <code><a href="../reference/Trials.html">?Trials</a></code>.</p>
<div class="section level2">
<h2 id="simulation-settings">Simulation Settings<a class="anchor" aria-label="anchor" href="#simulation-settings"></a>
</h2>
<p>In our simulation, we assume</p>
<ul>
<li>the response rates of binary endpoint as</li>
</ul>
<table class="table">
<thead><tr class="header">
<th>Dose</th>
<th>0</th>
<th>0.5</th>
<th>1.5</th>
<th>2.5</th>
<th>4</th>
</tr></thead>
<tbody><tr class="odd">
<td>Response Rate (%)</td>
<td>10.0</td>
<td>11.2</td>
<td>20.8</td>
<td>24.1</td>
<td>25.0</td>
</tr></tbody>
</table>
<ul>
<li>readout time is 1 week.</li>
<li>no dropout.</li>
<li>starting with a placebo arm and a treatment arm of the highest dose
(= 4), with a 1:1 randomization ratio.
<ul>
<li>enroll 5 patients per week for 7 weeks.</li>
</ul>
</li>
<li>an interim is planed when we have collected 30 readouts in total
from the two arms.
<ul>
<li>if z statistic of odds ratio is greater than 1
<ul>
<li>add three arms of dose 0.5, 1.5, and 2.5 to trial</li>
<li>enroll 20 patients per week with a randomization ratio 1:2:2:2:1,
until in total 150 patients are enrolled in the trial</li>
<li>final analysis is performed when readouts are available for all
enrolled patients.</li>
</ul>
</li>
<li>otherwise, stop the trial.</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="define-placebo-and-high-dose-arms">Define Placebo and High Dose Arms<a class="anchor" aria-label="anchor" href="#define-placebo-and-high-dose-arms"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/endpoint.html">endpoint</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'ep'</span>, type <span class="op">=</span> <span class="st">'non-tte'</span>, readout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>ep <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>               generator <span class="op">=</span> <span class="va">rbinom</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">pbo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/arm.html">arm</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'dose = 0.0'</span><span class="op">)</span></span>
<span><span class="va">pbo</span><span class="op">$</span><span class="fu">add_endpoints</span><span class="op">(</span><span class="va">ep</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/endpoint.html">endpoint</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'ep'</span>, type <span class="op">=</span> <span class="st">'non-tte'</span>, readout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>ep <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>               generator <span class="op">=</span> <span class="va">rbinom</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span>
<span><span class="va">trt4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/arm.html">arm</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'dose = 4.0'</span><span class="op">)</span></span>
<span><span class="va">trt4</span><span class="op">$</span><span class="fu">add_endpoints</span><span class="op">(</span><span class="va">ep</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="define-a-trial">Define a Trial<a class="anchor" aria-label="anchor" href="#define-a-trial"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">accrual_rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>end_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>                           piecewise_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">trial</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trial.html">trial</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'123'</span>, n_patients <span class="op">=</span> <span class="fl">150</span>, duration <span class="op">=</span> <span class="fl">14</span>,</span>
<span>               enroller <span class="op">=</span> <span class="va">StaggeredRecruiter</span>, accrual_rate <span class="op">=</span> <span class="va">accrual_rate</span>, </span>
<span>               silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">trial</span><span class="op">$</span><span class="fu">add_arms</span><span class="op">(</span>sample_ratio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, <span class="va">pbo</span>, <span class="va">trt4</span><span class="op">)</span></span>
<span><span class="va">trial</span></span>
<span><span class="co">#&gt;  ⚕⚕ Trial Name:  123  </span></span>
<span><span class="co">#&gt;  ⚕⚕ Description:  123  </span></span>
<span><span class="co">#&gt;  ⚕⚕ Number of Arms:  2  </span></span>
<span><span class="co">#&gt;  ⚕⚕ Registered Arms:  dose = 0.0, dose = 4.0  </span></span>
<span><span class="co">#&gt;  ⚕⚕ Sample Ratio:  1, 1  </span></span>
<span><span class="co">#&gt;  ⚕⚕ Number of Patients:  150  </span></span>
<span><span class="co">#&gt;  ⚕⚕ Planned Duration:  14  </span></span>
<span><span class="co">#&gt;  ⚕⚕ Random Seed:  1960520344</span></span></code></pre></div>
<!-- Hide this helper function and display it in Appendix for better typesetting. -->
<!-- Hide this action function and display it later for better typesetting. -->
<!-- Hide this action function and display it later for better typesetting. -->
</div>
<div class="section level2">
<h2 id="define-milestones-and-actions">Define Milestones and Actions<a class="anchor" aria-label="anchor" href="#define-milestones-and-actions"></a>
</h2>
<p>Two milestones are triggered when 30 and 150 readouts are collected,
respectively. Note that the 30 readouts are from the placebo and the
highest dose arm, while the 150 readouts are from all five arms.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/milestone.html">milestone</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'interim'</span>,</span>
<span>                     when <span class="op">=</span> <span class="fu"><a href="../reference/eventNumber.html">eventNumber</a></span><span class="op">(</span>endpoint <span class="op">=</span> <span class="st">'ep'</span>, n <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>                     action <span class="op">=</span> <span class="va">action_at_interim</span><span class="op">)</span></span>
<span></span>
<span><span class="va">final</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/milestone.html">milestone</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'final'</span>,</span>
<span>                   when <span class="op">=</span> <span class="fu"><a href="../reference/eventNumber.html">eventNumber</a></span><span class="op">(</span>endpoint <span class="op">=</span> <span class="st">'ep'</span>, n <span class="op">=</span> <span class="fl">150</span><span class="op">)</span>,</span>
<span>                   action <span class="op">=</span> <span class="va">action_at_final</span><span class="op">)</span></span></code></pre></div>
<p>In the action function <code>action_at_interim()</code>, we don’t
actually terminate the trial in simulation but always add dose arms.
Instead, we save the z statistic for summary later, e.g., computing the
proportion of early termination.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">action_at_interim</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">trial</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="co">## get data snapshot</span></span>
<span>  <span class="va">locked_data</span> <span class="op">&lt;-</span> <span class="va">trial</span><span class="op">$</span><span class="fu">get_locked_data</span><span class="op">(</span><span class="st">'interim'</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">## compare two arms</span></span>
<span>  <span class="co">## Risk difference = response rate in high dose - response rate in placebo</span></span>
<span>  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitLogistic.html">fitLogistic</a></span><span class="op">(</span><span class="va">ep</span> <span class="op">~</span> <span class="va">arm</span>, placebo <span class="op">=</span> <span class="st">'dose = 0.0'</span>,</span>
<span>                     data <span class="op">=</span> <span class="va">locked_data</span>, alternative <span class="op">=</span> <span class="st">'greater'</span>,</span>
<span>                     scale <span class="op">=</span> <span class="st">'risk difference'</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">## for summary of early termination</span></span>
<span>  <span class="va">trial</span><span class="op">$</span><span class="fu">save</span><span class="op">(</span>value <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">z</span>, name <span class="op">=</span> <span class="st">'z_value'</span><span class="op">)</span></span>
<span>  <span class="va">trial</span><span class="op">$</span><span class="fu">save</span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">z</span> <span class="op">&gt;</span> <span class="fl">1.64</span>, <span class="st">'add dose arms'</span>, <span class="st">'stop trial'</span><span class="op">)</span>, </span>
<span>             name <span class="op">=</span> <span class="st">'interim_decision'</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">## create three dose arms</span></span>
<span>  <span class="va">ep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/endpoint.html">endpoint</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'ep'</span>, type <span class="op">=</span> <span class="st">'non-tte'</span>, readout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>ep <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                 generator <span class="op">=</span> <span class="va">rbinom</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">.112</span><span class="op">)</span></span>
<span>  <span class="va">trt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/arm.html">arm</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'dose = 0.5'</span><span class="op">)</span></span>
<span>  <span class="va">trt1</span><span class="op">$</span><span class="fu">add_endpoints</span><span class="op">(</span><span class="va">ep</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">ep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/endpoint.html">endpoint</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'ep'</span>, type <span class="op">=</span> <span class="st">'non-tte'</span>, readout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>ep <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                 generator <span class="op">=</span> <span class="va">rbinom</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">.208</span><span class="op">)</span></span>
<span>  <span class="va">trt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/arm.html">arm</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'dose = 1.5'</span><span class="op">)</span></span>
<span>  <span class="va">trt2</span><span class="op">$</span><span class="fu">add_endpoints</span><span class="op">(</span><span class="va">ep</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">ep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/endpoint.html">endpoint</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'ep'</span>, type <span class="op">=</span> <span class="st">'non-tte'</span>, readout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>ep <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                 generator <span class="op">=</span> <span class="va">rbinom</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">.241</span><span class="op">)</span></span>
<span>  <span class="va">trt3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/arm.html">arm</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'dose = 2.5'</span><span class="op">)</span></span>
<span>  <span class="va">trt3</span><span class="op">$</span><span class="fu">add_endpoints</span><span class="op">(</span><span class="va">ep</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">## add three new arms to trial</span></span>
<span>  <span class="va">trial</span><span class="op">$</span><span class="fu">add_arms</span><span class="op">(</span>sample_ratio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, <span class="va">trt1</span>, <span class="va">trt2</span>, <span class="va">trt3</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>At final analysis, we analyze data from all five arms using MCPMod.
It calls a helper function <code>go_nogo()</code> which can be found in
the Appendix below.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">action_at_final</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">trial</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="va">locked_data</span> <span class="op">&lt;-</span> <span class="va">trial</span><span class="op">$</span><span class="fu">get_locked_data</span><span class="op">(</span><span class="st">'final'</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">trial</span><span class="op">$</span><span class="fu">save</span><span class="op">(</span>value <span class="op">=</span> <span class="fu">go_nogo</span><span class="op">(</span><span class="va">locked_data</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">'decision'</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="execute-a-trial">Execute a Trial<a class="anchor" aria-label="anchor" href="#execute-a-trial"></a>
</h2>
<p>After registering the two milestones with a listener, we simulate a
single trial using <code>controller$run()</code>. We can see that more
patients are randomized to the three newly added arms after interim,
reflecting the new randomization ratio 1:2:2:2:1.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">listener</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/listener.html">listener</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">listener</span><span class="op">$</span><span class="fu">add_milestones</span><span class="op">(</span><span class="va">interim</span>, <span class="va">final</span><span class="op">)</span></span>
<span></span>
<span><span class="va">controller</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/controller.html">controller</a></span><span class="op">(</span><span class="va">trial</span>, <span class="va">listener</span><span class="op">)</span></span>
<span><span class="va">controller</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, plot_event <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="doseRanging_files/figure-html/unnamed-chunk-7-1.png" class="r-plt" alt="" width="100%"></p>
<p>In this trial, the z statistic at interim is relatively low (1.33),
thus is early terminated even if in simulation we keep going with three
newly added dose arms.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="va">controller</span><span class="op">$</span><span class="fu">get_output</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">output</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">kable</span><span class="op">(</span>escape <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span>bootstrap_options <span class="op">=</span> <span class="st">"striped"</span>, </span>
<span>                full_width <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                position <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">scroll_box</span><span class="op">(</span>width <span class="op">=</span> <span class="st">"100%"</span><span class="op">)</span></span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; ">
<table class="table table table-striped" style="width: auto !important; ">
<thead><tr>
<th style="text-align:left;">
trial
</th>
<th style="text-align:right;">
seed
</th>
<th style="text-align:right;">
milestone_time_&lt;interim&gt;
</th>
<th style="text-align:right;">
n_events_&lt;interim&gt;_&lt;patient_id&gt;
</th>
<th style="text-align:right;">
n_events_&lt;interim&gt;_&lt;ep&gt;
</th>
<th style="text-align:left;">
n_events_&lt;interim&gt;_&lt;arms&gt;
</th>
<th style="text-align:right;">
z_value
</th>
<th style="text-align:left;">
interim_decision
</th>
<th style="text-align:right;">
milestone_time_&lt;final&gt;
</th>
<th style="text-align:right;">
n_events_&lt;final&gt;_&lt;patient_id&gt;
</th>
<th style="text-align:right;">
n_events_&lt;final&gt;_&lt;ep&gt;
</th>
<th style="text-align:left;">
n_events_&lt;final&gt;_&lt;arms&gt;
</th>
<th style="text-align:left;">
decision
</th>
<th style="text-align:left;">
error_message
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:left;">
123
</td>
<td style="text-align:right;">
1960520344
</td>
<td style="text-align:right;">
6.8
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:left;">
c(18, 15….
</td>
<td style="text-align:right;">
1.332786
</td>
<td style="text-align:left;">
stop trial
</td>
<td style="text-align:right;">
13.7
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:left;">
c(33, 33….
</td>
<td style="text-align:left;">
no-go
</td>
<td style="text-align:left;">
</td>
</tr></tbody>
</table>
</div>
<p>We can call <code>controller$run(n = 10)</code> to simulate
additional trials. in the function <code>action_at_final()</code>, the
go/no-go decision (<code>decision</code> in output) is determined under
the assumption that the dose has been expanded, regardless of the
interim evidence—this simplification is made solely for the convenience
of simulation. However, the overall probability of a <code>"go"</code>
should incorporate the interim results—specifically, the trial must not
be stopped at interim (i.e.,
<code>interim_decision == "add dose arms"</code>), and the function
<code>go_nogo()</code> must return <code>"go"</code> at the final
analysis.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## important: reset before calling run() again</span></span>
<span><span class="va">controller</span><span class="op">$</span><span class="fu">reset</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">controller</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>, plot_event <span class="op">=</span> <span class="cn">FALSE</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="va">controller</span><span class="op">$</span><span class="fu">get_output</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">kable</span><span class="op">(</span>escape <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span>bootstrap_options <span class="op">=</span> <span class="st">"striped"</span>, </span>
<span>                full_width <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                position <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">scroll_box</span><span class="op">(</span>width <span class="op">=</span> <span class="st">"100%"</span><span class="op">)</span></span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; ">
<table class="table table table-striped" style="width: auto !important; ">
<thead><tr>
<th style="text-align:left;">
trial
</th>
<th style="text-align:right;">
seed
</th>
<th style="text-align:right;">
milestone_time_&lt;interim&gt;
</th>
<th style="text-align:right;">
n_events_&lt;interim&gt;_&lt;patient_id&gt;
</th>
<th style="text-align:right;">
n_events_&lt;interim&gt;_&lt;ep&gt;
</th>
<th style="text-align:left;">
n_events_&lt;interim&gt;_&lt;arms&gt;
</th>
<th style="text-align:right;">
z_value
</th>
<th style="text-align:left;">
interim_decision
</th>
<th style="text-align:right;">
milestone_time_&lt;final&gt;
</th>
<th style="text-align:right;">
n_events_&lt;final&gt;_&lt;patient_id&gt;
</th>
<th style="text-align:right;">
n_events_&lt;final&gt;_&lt;ep&gt;
</th>
<th style="text-align:left;">
n_events_&lt;final&gt;_&lt;arms&gt;
</th>
<th style="text-align:left;">
decision
</th>
<th style="text-align:left;">
error_message
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
123
</td>
<td style="text-align:right;">
2006631926
</td>
<td style="text-align:right;">
6.8
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:left;">
c(17, 15….
</td>
<td style="text-align:right;">
1.0350983
</td>
<td style="text-align:left;">
stop trial
</td>
<td style="text-align:right;">
13.7
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:left;">
c(32, 32….
</td>
<td style="text-align:left;">
go
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
123
</td>
<td style="text-align:right;">
447300730
</td>
<td style="text-align:right;">
6.8
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:left;">
c(17, 15….
</td>
<td style="text-align:right;">
-1.5191090
</td>
<td style="text-align:left;">
stop trial
</td>
<td style="text-align:right;">
13.7
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:left;">
c(32, 32….
</td>
<td style="text-align:left;">
no-go
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
123
</td>
<td style="text-align:right;">
1544385735
</td>
<td style="text-align:right;">
6.8
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:left;">
c(17, 15….
</td>
<td style="text-align:right;">
1.0954461
</td>
<td style="text-align:left;">
stop trial
</td>
<td style="text-align:right;">
13.7
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:left;">
c(32, 32….
</td>
<td style="text-align:left;">
no-go
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
123
</td>
<td style="text-align:right;">
2131809493
</td>
<td style="text-align:right;">
6.8
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:left;">
c(18, 15….
</td>
<td style="text-align:right;">
1.9364917
</td>
<td style="text-align:left;">
add dose arms
</td>
<td style="text-align:right;">
13.7
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:left;">
c(33, 33….
</td>
<td style="text-align:left;">
no-go
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
123
</td>
<td style="text-align:right;">
799237881
</td>
<td style="text-align:right;">
6.8
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:left;">
c(17, 15….
</td>
<td style="text-align:right;">
1.0954461
</td>
<td style="text-align:left;">
stop trial
</td>
<td style="text-align:right;">
13.7
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:left;">
c(32, 32….
</td>
<td style="text-align:left;">
no-go
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
123
</td>
<td style="text-align:right;">
1359695008
</td>
<td style="text-align:right;">
6.8
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:left;">
c(17, 15….
</td>
<td style="text-align:right;">
1.5256441
</td>
<td style="text-align:left;">
stop trial
</td>
<td style="text-align:right;">
13.7
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:left;">
c(32, 32….
</td>
<td style="text-align:left;">
no-go
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
123
</td>
<td style="text-align:right;">
2040133893
</td>
<td style="text-align:right;">
6.8
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:left;">
c(18, 15….
</td>
<td style="text-align:right;">
0.4330129
</td>
<td style="text-align:left;">
stop trial
</td>
<td style="text-align:right;">
13.7
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:left;">
c(33, 33….
</td>
<td style="text-align:left;">
no-go
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
123
</td>
<td style="text-align:right;">
715681929
</td>
<td style="text-align:right;">
6.8
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:left;">
c(18, 15….
</td>
<td style="text-align:right;">
1.5191090
</td>
<td style="text-align:left;">
stop trial
</td>
<td style="text-align:right;">
13.7
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:left;">
c(33, 33….
</td>
<td style="text-align:left;">
go
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
123
</td>
<td style="text-align:right;">
1222856748
</td>
<td style="text-align:right;">
6.8
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:left;">
c(18, 15….
</td>
<td style="text-align:right;">
1.5256441
</td>
<td style="text-align:left;">
stop trial
</td>
<td style="text-align:right;">
13.7
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:left;">
c(33, 33….
</td>
<td style="text-align:left;">
no-go
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
123
</td>
<td style="text-align:right;">
1512640951
</td>
<td style="text-align:right;">
6.8
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:left;">
c(18, 15….
</td>
<td style="text-align:right;">
1.9364930
</td>
<td style="text-align:left;">
add dose arms
</td>
<td style="text-align:right;">
13.7
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:left;">
c(33, 33….
</td>
<td style="text-align:left;">
go
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Number of overall Go</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">interim_decision</span> <span class="op">==</span> <span class="st">'add dose arms'</span> <span class="op">&amp;</span> <span class="st">'decision'</span> <span class="op">==</span> <span class="st">'go'</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span></span>
<span><span class="co">## Number of early trial termination</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">interim_decision</span> <span class="op">==</span> <span class="st">'stop trial'</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 8</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="appendix-code-of-helper-function">Appendix: Code of Helper Function<a class="anchor" aria-label="anchor" href="#appendix-code-of-helper-function"></a>
</h2>
<p>For completeness, the full code of the helper functions
<code>go_nogo()</code> is included below, which informs go/no-go
decision at the end of the trial.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">go_nogo</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="co">## candidate models for MCPMod</span></span>
<span>  <span class="va">doses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">2.5</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="va">candidates</span> <span class="op">&lt;-</span> <span class="fu">Mods</span><span class="op">(</span>emax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.25</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                     sigEmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     betaMod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.1</span>, <span class="fl">1.1</span><span class="op">)</span>,</span>
<span>                     placEff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">.1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     maxEff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.25</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">.25</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">.1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     doses <span class="op">=</span> <span class="va">doses</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">ep</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">arm</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0</span>, data <span class="op">=</span> <span class="va">data</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span>  <span class="va">mu_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span>  <span class="va">S_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">## multiple contrast test</span></span>
<span>  <span class="va">test</span> <span class="op">&lt;-</span> <span class="fu">DoseFinding</span><span class="fu">::</span><span class="fu"><a href="https://openpharma.github.io/DoseFinding/reference/MCTtest.html" class="external-link">MCTtest</a></span><span class="op">(</span>dose <span class="op">=</span> <span class="va">doses</span>,</span>
<span>                               <span class="va">mu_hat</span>, S <span class="op">=</span> <span class="va">S_hat</span>,</span>
<span>                               models <span class="op">=</span> <span class="va">candidates</span>, type <span class="op">=</span> <span class="st">"general"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">## model averaging</span></span>
<span>  <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">DoseFinding</span><span class="fu">::</span><span class="fu"><a href="https://openpharma.github.io/DoseFinding/reference/maFitMod.html" class="external-link">maFitMod</a></span><span class="op">(</span>dose <span class="op">=</span> <span class="va">doses</span>,</span>
<span>                                 <span class="va">mu_hat</span>, S <span class="op">=</span> <span class="va">S_hat</span>,</span>
<span>                                 models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"emax"</span>, <span class="st">"sigEmax"</span>, <span class="st">"betaMod"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## predict response rate per dose</span></span>
<span>  <span class="va">prd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, summaryFct <span class="op">=</span> <span class="va">median</span>, doseSeq <span class="op">=</span> <span class="va">doses</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## convert to scale of probability</span></span>
<span>  <span class="va">prd_rate</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">prd</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">## go/no-go rule: MCP test p-value &lt; 0.05 and estimated effect &gt; 10%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">test</span><span class="op">$</span><span class="va">tStat</span>, <span class="st">'pVal'</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">.05</span> <span class="op">&amp;</span></span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">prd_rate</span> <span class="op">-</span> <span class="va">prd_rate</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">.1</span>, <span class="st">'go'</span>, <span class="st">'no-go'</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Han Zhang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
